<!DOCTYPE html>

<html>

<head>
    <title><%= @school.name %></title>
    <link href="/css/reset.css" rel="stylesheet" type="text/css">
    <link href="/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="/css/master.css" rel="stylesheet" type="text/css">
    <link href="/css/school_page.css" rel="stylesheet" type="text/css">
</head>

<body>

<!-- Navigation Bar -->
<div class="navbar navbar-inverse navbar-fixed-top">
    <div class="navbar-inner">
        <div class="container" id="nav-elements">
            <div class="nav-collapse collapse">
                <ul class="nav">
                  <li class="">
                    <a href="/">Buzzme</a>
                  </li>
                  <li>
                    <a href="/about">About Us</a>
                  </li>
                </ul>
                <!--Search for a School-->
                <div class="input-append" id="nav-school-search">
                    <input name="school" id="nav-school-search-field" type="text" placeholder="Search for a school">
                    <button type="submit" class="btn">Search</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="wrapper">
<div class="page">

    <!-- School Name -->
    <h1 id="school-name"><%= @school.name %></h1>
    <!--Message Feed-->
    <div class="feed">

        <!-- Sorting -->
        <div id="sort">
            Sort by: <a id="butt" href="/school/<%= @school.id %>/recent">Most Recent</a> | <a href="/school/<%= @school.id %>/trending">Most Popular</a>
        </div>

        <% @messages.each do |message| %>
            
            <!-- feed entry for each message -->
            <div class="message">
                Dear <a id="target-name" href="#"><%= message.target.name %></a>,

                <span class="message-body"> <%= message.body %></span>

                <div class="message-bottom-bar">
                    <span class="timestamp"><%= format_timestamp(message.created_at) %></span>
                    <span class="message-controls">
                    <a class="like_button" data-messageid="<%=message['id']%>" href="/like/<%=message['id']%>">
                    Buzz Up! (<%= message.likes %>)</a> | 
                    <a href="#">Comment</a> | 
                    <a href ="#">Abuse</a>
                    </span>
                </div>
            </div>
        <%end%>
    </div>

    <!-- Sidebar -->

    <div class="sidebar">
        <div class="nav-header" id="compliment-label"><i class="icon-heart"></i> Leave a compliment!</div>
        <form method="POST" action="">
            <input id="sidebar-enter-name" type="text" name="target" placeholder="Student's Name"></input>
            <textarea id="sidebar-enter-message" name="message" placeholder="Write them a compliment!"></textarea>
            <button id="buzz-button" class="btn btn-large button btn-info" type="submit"><i class="icon-comment icon-white"></i> Share!</button>
        </form>
    </div>

</div>
</div>


<!-- Scripts -->
<script src="http://code.jquery.com/jquery.js"></script>
<script src="js/bootstrap.min.js"></script>
<!-- script to make ajax call to '/like/messageId' when like button is clicked -->
<script type="text/javascript">
    $(".like_button").click(function() {
        var messageid = $(this).data("messageid");
        $.get("/like/" + messageid);

    });

    // set classname of currently selected sorting option
    // to 'current-sort'
    var sortLinks = $("#sort a");
    for (var i = 0; i < sortLinks.length; i++) {
        if (sortLinks[i].pathname === window.location.pathname) {
            sortLinks.eq(i).addClass('current-sort');
        }
    }

    $(function() {

        var $sidebar = $(".sidebar"), 
            $window = $(window),
            initialOffset = $sidebar.offset(),
            topPadding = 80;
            duration = 300;

        // sidebar follow
        $window.scroll(function() {
            console.log("window.scrollTop(): " + $window.scrollTop());
            //console.log("offset.top: " + initialOffset.top);
            if ($window.scrollTop() > initialOffset.top) {
                $sidebar.stop().animate({
                    // subtract initialOffset.top of sidebar because it's positioned
                    // relative to its container, and it starts off at 0
                    // since top is relative and window.scrollTop() is absolute,
                    // correct window.scrollTop() to be relative to the top of the
                    // sidebar's container element
                    top: ($window.scrollTop() - initialOffset.top) + topPadding
                }, duration);

            } else {
                $sidebar.stop().animate({
                    top: 0
                }, duration);
            }
        });

    });

</script>


</body>
</html>