<!DOCTYPE html>

<html>

<head>
    <link href="/css/master.css" rel="stylesheet" type="text/css">
    <link href="/css/target_page.css" rel="stylesheet" type="text/css">
    
    <title><%= @target.name %></title>
</head>

<body>

<!-- Navigation Bar -->
<div class="navbar navbar-inverse navbar-fixed-top">
    <div class="navbar-inner">
        <div class="container" id="nav-elements">
            <div class="nav-collapse collapse">
                <ul class="nav">
                  <li>
                    <a id="buzzme" href="/">Buzzme</a>
                  </li>
                  <li>
                    <a href="/about">About Us</a>
                  </li>
                  <li>
                    <!-- page for all recent posts -->
                    <a href="/feed">Recent</a>
                  </li>                
                </ul>
                <!--Search for a School-->
                <div class="input-append" id="nav-school-search">
                    <input name="school" id="nav-school-search-field" type="text" placeholder="Search for a school">
                    <button type="submit" class="btn">Search</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="wrapper">
<div id="page">

    <!-- School Name -->
    <h1 id="breadcrumb">
        <a href="/school/<%= @school.id %>/recent"><%= @school.name %></a>
        <span id="breadcrumb-separator">></span>
        <a href="/target/<%= @target.id %>/recent"><%= @target.name %></a>
    </h1>
    <!--Message Feed-->
    <div id="feed">

        <!-- Sorting -->
        <div id="sort">
            Sort by: <a href="/target/<%= @target.id %>/recent">Most Recent</a> | <a href="/target/<%= @target.id %>/trending">Most Popular</a>
        </div>

        <% @messages.each do |message| %>
            
            <!-- feed entry for each message -->
            <div class="message">
                Dear <a id="target-name" href="#"><%= message.target.name %></a>,

                <span class="message-body"> <%= message.body %></span>

                <div class="message-bottom-bar">
                    <span class="timestamp"><%= format_timestamp(message.created_at) %></span>
                    <span class="message-controls">
                    <a class="like_button" data-messageid="<%=message['id']%>" href="/like/<%=message['id']%>">
                    Buzz Up! (<%= message.likes %>)</a> | 
                    <a href="#">Comment</a> | 
                    <a href ="#">Abuse</a>
                    </span>
                </div>
            </div>
        <%end%>
    </div>

    <!-- Sidebar -->

    <div id="sidebar">
        <div class="nav-header" id="compliment-label"><i class="icon-heart"></i> Leave <%= @target.name.split(" ")[0] %> a compliment!</div>
        <form method="POST" action="">
            <textarea id="sidebar-enter-message" name="message" placeholder="Tell <%= @target.name.split(" ")[0] %> something nice!"></textarea>
            <button id="buzz-button" class="btn btn-large button btn-info" type="submit"><i class="icon-comment icon-white"></i> Share!</button>
        </form>
    </div>

</div>
</div>


<!-- Scripts -->
<script src="http://code.jquery.com/jquery.js"></script>
<script src="js/bootstrap.min.js"></script>
<!-- script to make ajax call to '/like/messageId' when like button is clicked -->
<script type="text/javascript">
    $(".like_button").click(function() {
        var messageid = $(this).data("messageid");
        $.get("/like/" + messageid);

    });

    // set classname of currently selected sorting option
    // to 'current-sort'
    var sortLinks = $("#sort a");
    for (var i = 0; i < sortLinks.length; i++) {
        if (sortLinks[i].pathname === window.location.pathname) {
            sortLinks.eq(i).addClass('current-sort');
        }
    }
</script>
<!-- Following Sidebar
<script type="text/javascript" src="js/sidbar.js"></script>
-->

</body>
</html>